<html>

<head>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800" />

  <title>Meal Planner</title>
  <link rel="icon" type="image/x-icon"    href="https://is3-ssl.mzstatic.com/image/thumb/Purple111/v4/7d/05/17/7d0517b1-f45f-af98-bf8f-87d454ca57f6/source/512x512bb.jpg" />

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    #meal-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      /* Dynamically adjust columns */
      gap: 16px;
      /* Space between items */
      padding: 16px;
      /* Optional padding */
    }
  </style>
</head>

<body>
  <div class="relative flex size-full min-h-screen flex-col bg-[#FFFFFF] group/design-root overflow-x-hidden"
    style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#F4EFE6] px-10 py-3">
        <div class="flex items-center gap-8">
          <div class="flex items-center gap-4 text-[#1C160C]">
            <div class="size-4">
              <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z"
                  fill="currentColor"></path>
              </svg>
            </div>
            <h2 class="text-[#1C160C] text-lg font-bold leading-tight tracking-[-0.015em]">EasyCart</h2>
          </div>
        </div>
        <div class="flex flex-1 justify-end gap-8">
          <div class="flex items-center gap-9">
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="Afterlogin.html">Home</a>
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="Cart.html?from=MealPlanner.html">Cart</a>
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="GroceryList.html">Groceries</a>
          </div>
          <div class="flex gap-2">
          </div>
          <!-- <button
            class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#F4EFE6] text-[#1C160C] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
            <a href="Profile.html">
              <div class="text-[#1C160C]" data-icon="User" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                  </path>
                </svg>
              </div>
            </a>
            https://ec-backend-0lvq.onrender.com
          </button> -->
      </header>
      <div class="gap-1 px-6 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-80">
          <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#FFFFFF] p-4">
            <div class="flex flex-col gap-4">
              <div class="flex gap-3">
                <button
            class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#F4EFE6] text-[#1C160C] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
            <a href="Profile.html">
              <div class="text-[#1C160C]" data-icon="User" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                  </path>
                </svg>
              </div>
            </a>
          </button>
                <div class="flex flex-col">
                  <h1 class="text-[#1C160C] text-base font-medium leading-normal">Hello, there!</h1>
                  <p class="text-[#A18249] text-sm font-normal leading-normal">Plan your meals smarter.</p>
                </div>
              </div>
              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="Gauge" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M207.06,80.67A111.24,111.24,0,0,0,128,48h-.4C66.07,48.21,16,99,16,161.13V184a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V160A111.25,111.25,0,0,0,207.06,80.67ZM224,184H119.71l54.76-75.3a8,8,0,0,0-12.94-9.42L99.92,184H32V161.13c0-3.08.15-6.12.43-9.13H56a8,8,0,0,0,0-16H35.27c10.32-38.86,44-68.24,84.73-71.66V88a8,8,0,0,0,16,0V64.33A96.14,96.14,0,0,1,221,136H200a8,8,0,0,0,0,16h23.67c.21,2.65.33,5.31.33,8Z">
                      </path>
                    </svg>
                  </div>
                  <a href="DashBoard.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Dashboard</p>
                  </a>
                </div>
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="CodepenLogo" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M235.79,89l-104-56a8,8,0,0,0-7.58,0l-104,56A8,8,0,0,0,16,96v64a8,8,0,0,0,4.21,7.05l104,56a8,8,0,0,0,7.58,0l104-56A8,8,0,0,0,240,160V96A8,8,0,0,0,235.79,89ZM224,146.61,189.45,128,224,109.39Zm-51.43-27.7L136,99.22V53.39L215.13,96Zm-44.57,24L100.3,128,128,113.09,155.7,128Zm-8-89.52V99.22L83.43,118.91,40.87,96Zm-88,56L66.55,128,32,146.61Zm51.43,27.7L120,156.78v45.83L40.87,160ZM136,202.61V156.78l36.57-19.69L215.13,160Z">
                      </path>
                    </svg>
                  </div>
                  <a href="Recipes.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Recipes</p>
                  </a>
                </div>
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="ToggleRight" data-size="24px" data-weight="regular">
                    <!-- <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"> -->
                    <path
                      d="M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,128H80A56,56,0,0,1,80,72h96a56,56,0,0,1,0,112Zm0-96a40,40,0,1,0,40,40A40,40,0,0,0,176,88Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,176,152Z">
                    </path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-4">
              <div class="flex flex-col gap-1">
                <!-- <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="ArrowCircleUp" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm37.66-101.66a8,8,0,0,1-11.32,11.32L136,107.31V168a8,8,0,0,1-16,0V107.31l-18.34,18.35a8,8,0,0,1-11.32-11.32l32-32a8,8,0,0,1,11.32,0Z">
                      </path>
                    </svg>
                  </div>
                  <p class="text-[#1C160C] text-sm font-medium leading-normal">Help</p>
                </div> -->
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="SignOut" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L196.69,120H104a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,221.66,122.34Z">
                      </path>
                    </svg>
                  </div>
                  <a href="index.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Logout</p>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <div class="flex flex-wrap justify-between gap-3 p-4">
            <div class="flex min-w-72 flex-col gap-3">
              <p class="text-[#1C160C] text-4xl font-black leading-tight tracking-[-0.033em]">Meal Planner</p>
              <p class="text-[#A18249] text-base font-normal leading-normal">Plan your meals for the week.</p>
            </div>
          </div>
          <div class="flex flex-wrap items-center justify-center gap-6 p-4">
            <div class="flex min-w-72 max-w-[336px] flex-1 flex-col gap-0.5">
              <div class="flex items-center p-1 justify-between">
                <button id="prev-button">
                  <div class="text-[#1C160C] flex size-10 items-center justify-center" data-icon="CaretLeft"
                    data-size="18px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z">
                      </path>
                    </svg>
                  </div>
                </button>
                <p id="month-display" class="text-[#1C160C] text-base font-bold leading-tight flex-1 text-center pr-10">
                  January 2025</p>
                <button id="next-button">
                  <div class="text-[#1C160C] flex size-10 items-center justify-center" data-icon="CaretRight"
                    data-size="18px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z">
                      </path>
                    </svg>
                  </div>
                </button>
              </div>
              <div id="calendar-container"></div>
            </div>
            <div class="flex flex-col gap-4 p-4 bg-[#F4EFE6] rounded-xl">
              <h3 class="text-[#1C160C] text-lg font-bold">Add New Meal</h3>
              <p class="text-[#A18249] text-sm">Select a date and add a meal for your plan</p>

              <div class="flex flex-col gap-3 mt-2">
                <button id="breakfast-btn"
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Breakfast</span>
                </button>
                <button id="lunch-btn"
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Lunch</span>
                </button>
                <button id="snack-btn"
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Snack</span>
                </button>
                <button id="dinner-btn"
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Dinner</span>
                </button>
              </div>

              <div class="mt-4">
                <p id="selected-date-display" class="text-[#1C160C] font-medium"></p>
              </div>
            </div>
          </div>
          <div id="meal-container"></div>
          <div class="flex flex-col gap-3 p-4">
            <!-- <div class="flex gap-6 justify-between">
              <p class="text-[#1C160C] text-base font-medium leading-normal">Meal Plan Adherence</p>
              <p class="text-[#1C160C] text-sm font-normal leading-normal">60%</p>
            </div>
            <div class="rounded bg-[#E9DFCE]">
              <div class="h-2 rounded bg-[#019863]" style="width: 60%;"></div>
            </div>
            <p class="text-[#A18249] text-sm font-normal leading-normal">Keep up the great work!</p>
          </div> -->
        </div>
        </footer>
      </div>
    </div>
  </div>
  </div>

  <script>

document.addEventListener("DOMContentLoaded", function () {
  // Constants
  const festivals = [5, 15, 25]; // Example: dates that are festivals
  const today = new Date();
  let currentYear = today.getFullYear(); // Get current year dynamically
  let currentMonth = today.getMonth(); // Get current month dynamically (0-indexed)
  const formattedToday = today.toISOString().split("T")[0]; // Today's date in YYYY-MM-DD format
  let selectedDate = formattedToday; // Track the currently selected date

  // DOM Elements
  const calendarContainer = document.getElementById("calendar-container");
  const monthDisplay = document.getElementById("month-display");
  const prevButton = document.getElementById("prev-button");
  const nextButton = document.getElementById("next-button");
  const mealContainer = document.getElementById("meal-container");
  const breakfastBtn = document.getElementById("breakfast-btn");
  const lunchBtn = document.getElementById("lunch-btn");
  const snackBtn = document.getElementById("snack-btn");
  const dinnerBtn = document.getElementById("dinner-btn");
  const selectedDateDisplay = document.getElementById("selected-date-display");

  // Month Names
  const monthNames = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  // Function to Render Calendar
  const renderCalendar = (year, month) => {
    const firstDay = new Date(year, month, 1).getDay(); // First day of the month (0-indexed)
    const daysInMonth = new Date(year, month + 1, 0).getDate(); // Days in the month

    // Update Month and Year Display
    monthDisplay.textContent = `${monthNames[month]} ${year}`;

    // Days of the Week Header
    const daysOfWeek = ["S", "M", "T", "W", "T", "F", "S"];
    let gridHtml = daysOfWeek.map(day => `
        <p class="text-[#1C160C] text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">${day}</p>
    `).join("");

    // Populate Dates
    let daysHtml = "";
    for (let i = 0; i < firstDay; i++) {
      daysHtml += `<div class="h-12 w-full"></div>`; // Blank spaces for days before the first of the month
    }
    for (let day = 1; day <= daysInMonth; day++) {
      let classes = "h-12 w-full bg-[#F4EFE6] text-[#1C160C] text-sm font-medium leading-normal";

      // Highlight today
      if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
        classes = "h-12 w-12 text-[#FFFFFF] bg-[#000802] text-sm font-medium leading-normal rounded-full";
      }

      // Highlight festivals
      if (festivals.includes(day)) {
        classes = "h-12 w-full bg-[#F4EFE6] text-[#FFD700] text-sm font-medium leading-normal"; // Highlighted with gold color
      }

      const date = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;

      daysHtml += `
            <button class="${classes} calendar-button" data-date="${date}">
                <div class="flex size-full items-center justify-center rounded-full">${day}</div>
            </button>
        `;
    }

    // Render Calendar
    calendarContainer.innerHTML = `
        <div class="grid grid-cols-7">
            ${gridHtml}
            ${daysHtml}
        </div>
    `;

    // Attach Event Listeners to Date Buttons
    attachCalendarButtonListeners();
  };

  // Function to Fetch Meals
  const fetchMeals = (date) => {
    // Store the currently selected date
    selectedDate = date;
    
    fetch(`https://ec-backend-0lvq.onrender.com/api/meals?date=${date}`)
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        displayMeals(data, date);
        updateMealButtons(data);
        selectedDateDisplay.textContent = `Selected: ${formatDateForDisplay(date)}`;
      })
      .catch((error) => {
        console.error("Error fetching meals:", error);
        mealContainer.innerHTML = "<p class='text-center text-red-500'>Error loading recipes.</p>";
      });
  };

  // Function to format date for display
  const formatDateForDisplay = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  };

  // Function to update meal buttons based on fetched data
  const updateMealButtons = (meals) => {
    // Reset all buttons to default state
    resetMealButtons();

    if (meals && meals.length > 0) {
      meals.forEach(meal => {
        const mealType = meal.meal_type.toLowerCase();
        const button = document.getElementById(`${mealType}-btn`);

        if (button) {
          button.disabled = true;
          button.classList.add('opacity-50', 'cursor-not-allowed');
          button.innerHTML = `<span>${mealType.charAt(0).toUpperCase() + mealType.slice(1)} Added</span>`;
        }
      });
    }
  };

  // Function to reset all meal buttons to default state
  const resetMealButtons = () => {
    const mealTypes = ['breakfast', 'lunch', 'snack', 'dinner'];

    mealTypes.forEach(type => {
      const button = document.getElementById(`${type}-btn`);
      if (button) {
        button.disabled = false;
        button.classList.remove('opacity-50', 'cursor-not-allowed');
        button.innerHTML = `<span>Add ${type.charAt(0).toUpperCase() + type.slice(1)}</span>`;
      }
    });
  };

  // Function to Display Meals
  const displayMeals = (meals, date) => {
    mealContainer.innerHTML = ""; // Clear previous content

    if (meals.length === 0) {
      mealContainer.innerHTML = "<p class='text-center col-span-full text-gray-500'>No meals found for the selected date.</p>";
      return;
    }

    meals.forEach((meal) => {
      const mealCard = document.createElement("div");
      mealCard.classList.add("flex", "flex-col", "gap-3", "pb-3", "items-center", "text-center");

      mealCard.innerHTML = `
            <div class="flex flex-col gap-3 pb-3 items-center text-center">
                <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-xl"
                    style='background-image: url("${meal.meal_image || "https://cdn.usegalileo.ai/sdxl10/55592608-5a64-4ee3-8946-6dda8caa409f.png"}"); width: 150px; height: 150px;'>
                </div>
                <div>
                    <p class="text-[#A18249] text-sm font-normal leading-normal">${meal.meal_name}</p>
                    <p class="text-[#1C160C] text-base font-medium leading-normal">${meal.meal_type}</p>
                    <a href="ChangeMeal.html?date=${date}&mealType=${meal.meal_type.toLowerCase()}&mealId=${meal.meal_id || ''}">
                    <button
                        class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#F4EFE6] text-[#1C160C] text-sm font-bold leading-normal tracking-[0.015em]">
                        <span class="truncate">Change Meal</span>
                    </button></a>
                </div>
            </div>
        `;

      mealContainer.appendChild(mealCard);
    });
  };

  // Function to Highlight Selected Date
  const highlightSelectedDate = (selectedButton) => {
    const calendarButtons = document.querySelectorAll(".calendar-button");
    calendarButtons.forEach((button) => {
      button.classList.remove("selected-date"); // Remove highlight
    });
    selectedButton.classList.add("selected-date"); // Highlight the selected button
  };

  // Function to Attach Listeners to Date Buttons
  const attachCalendarButtonListeners = () => {
    const calendarButtons = document.querySelectorAll(".calendar-button");
    calendarButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const selectedDate = button.getAttribute("data-date"); // Get the date from button's data attribute
        fetchMeals(selectedDate); // Fetch meals for the selected date
        highlightSelectedDate(button); // Highlight the selected date
      });
    });
  };

  // Event Listeners for Month Navigation
  prevButton.addEventListener("click", () => {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11; // Wrap to December
      currentYear--;
    }
    renderCalendar(currentYear, currentMonth);
  });

  nextButton.addEventListener("click", () => {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0; // Wrap to January
      currentYear++;
    }
    renderCalendar(currentYear, currentMonth);
  });

  // Add event listeners for meal buttons
  const addMealButtons = [breakfastBtn, lunchBtn, snackBtn, dinnerBtn];
  addMealButtons.forEach(button => {
    if (button) {
      button.addEventListener("click", () => {
        const mealType = button.id.replace("-btn", "");
        window.location.href = `ChangeMeal.html?date=${selectedDate}&mealType=${mealType}`;
      });
    }
  });

  // Initial Render and Fetch for Current Date
  renderCalendar(currentYear, currentMonth);
  fetchMeals(formattedToday);
  
  // Note: updateAdherencePercentage function call is in the original code
  // but the function itself is not provided in the snippet
  // If it exists elsewhere in your code, you can keep this line
  // updateAdherencePercentage();
});
</script>
</body>

</html>
