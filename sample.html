<html>

<head>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800" />

  <title>Meal Planner</title>
  <link rel="icon" type="image/x-icon"
    href="https://is3-ssl.mzstatic.com/image/thumb/Purple111/v4/7d/05/17/7d0517b1-f45f-af98-bf8f-87d454ca57f6/source/512x512bb.jpg" />

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    #meal-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      padding: 16px;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .calendar-day-button {
      transition: all 0.3s ease;
    }
    
    .calendar-day-button:hover {
      background-color: #EAEAEA !important;
      transform: scale(1.05);
    }
    
    .selected-date {
      background-color: #A18249 !important;
      color: white !important;
    }
    
    .meal-type-btn {
      transition: all 0.2s ease;
    }
    
    .meal-type-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .planner-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .planner-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="relative flex size-full min-h-screen flex-col bg-[#FFFFFF] group/design-root overflow-x-hidden"
    style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#F4EFE6] px-10 py-3">
        <div class="flex items-center gap-8">
          <div class="flex items-center gap-4 text-[#1C160C]">
            <div class="size-4">
              <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z"
                  fill="currentColor"></path>
              </svg>
            </div>
            <h2 class="text-[#1C160C] text-lg font-bold leading-tight tracking-[-0.015em]">EasyCart</h2>
          </div>
          <label class="flex flex-col min-w-40 !h-10 max-w-64">
            <div class="flex w-full flex-1 items-stretch rounded-xl h-full">
              <div
                class="text-[#A18249] flex border-none bg-[#F4EFE6] items-center justify-center pl-4 rounded-l-xl border-r-0"
                data-icon="MagnifyingGlass" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z">
                  </path>
                </svg>
              </div>
              <input placeholder="Search"
                class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1C160C] focus:outline-0 focus:ring-0 border-none bg-[#F4EFE6] focus:border-none h-full placeholder:text-[#A18249] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal"
                value="" />
            </div>
          </label>
        </div>
        <div class="flex flex-1 justify-end gap-8">
          <div class="flex items-center gap-9">
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="AfterLogin.html">Home</a>
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="Recipes.html">Recipes</a>
            <a class="text-[#1C160C] text-sm font-medium leading-normal" href="GroceryList.html">Grocery List</a>
          </div>
          <div class="flex gap-2">
          </div>
          <button
            class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#F4EFE6] text-[#1C160C] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
            <a href="Profile.html">
              <div class="text-[#1C160C]" data-icon="User" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                  </path>
                </svg>
              </div>
            </a>
          </button>
      </header>
      <div class="gap-1 px-6 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-80">
          <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#FFFFFF] p-4">
            <div class="flex flex-col gap-4">
              <div class="flex gap-3">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                  style='background-image: url("https://cdn.usegalileo.ai/sdxl10/a972cc5a-faa3-4900-a0c3-dbd9d99e1001.png");'>
                </div>
                <div class="flex flex-col">
                  <h1 class="text-[#1C160C] text-base font-medium leading-normal">Hello, <span id="username">User</span>!</h1>
                  <p class="text-[#A18249] text-sm font-normal leading-normal">Plan your meals smarter.</p>
                </div>
              </div>
              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="Gauge" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M207.06,80.67A111.24,111.24,0,0,0,128,48h-.4C66.07,48.21,16,99,16,161.13V184a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V160A111.25,111.25,0,0,0,207.06,80.67ZM224,184H119.71l54.76-75.3a8,8,0,0,0-12.94-9.42L99.92,184H32V161.13c0-3.08.15-6.12.43-9.13H56a8,8,0,0,0,0-16H35.27c10.32-38.86,44-68.24,84.73-71.66V88a8,8,0,0,0,16,0V64.33A96.14,96.14,0,0,1,221,136H200a8,8,0,0,0,0,16h23.67c.21,2.65.33,5.31.33,8Z">
                      </path>
                    </svg>
                  </div>
                  <a href="DashBoard.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Dashboard</p>
                  </a>
                </div>
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="CodepenLogo" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M235.79,89l-104-56a8,8,0,0,0-7.58,0l-104,56A8,8,0,0,0,16,96v64a8,8,0,0,0,4.21,7.05l104,56a8,8,0,0,0,7.58,0l104-56A8,8,0,0,0,240,160V96A8,8,0,0,0,235.79,89ZM224,146.61,189.45,128,224,109.39Zm-51.43-27.7L136,99.22V53.39L215.13,96Zm-44.57,24L100.3,128,128,113.09,155.7,128Zm-8-89.52V99.22L83.43,118.91,40.87,96Zm-88,56L66.55,128,32,146.61Zm51.43,27.7L120,156.78v45.83L40.87,160ZM136,202.61V156.78l36.57-19.69L215.13,160Z">
                      </path>
                    </svg>
                  </div>
                  <a href="Recipes.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Recipes</p>
                  </a>
                </div>
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="ToggleRight" data-size="24px" data-weight="regular">
                    <path
                      d="M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,128H80A56,56,0,0,1,80,72h96a56,56,0,0,1,0,112Zm0-96a40,40,0,1,0,40,40A40,40,0,0,0,176,88Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,176,152Z">
                    </path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-4">
              <div class="flex flex-col gap-1">
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="ArrowCircleUp" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm37.66-101.66a8,8,0,0,1-11.32,11.32L136,107.31V168a8,8,0,0,1-16,0V107.31l-18.34,18.35a8,8,0,0,1-11.32-11.32l32-32a8,8,0,0,1,11.32,0Z">
                      </path>
                    </svg>
                  </div>
                  <p class="text-[#1C160C] text-sm font-medium leading-normal">Help</p>
                </div>
                <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="SignOut" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L196.69,120H104a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,221.66,122.34Z">
                      </path>
                    </svg>
                  </div>
                  <a href="Homepage.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Logout</p>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <div class="flex flex-wrap justify-between gap-3 p-4">
            <div class="flex min-w-72 flex-col gap-3">
              <p class="text-[#1C160C] text-4xl font-black leading-tight tracking-[-0.033em]">Meal Planner</p>
              <p class="text-[#A18249] text-base font-normal leading-normal">Plan your meals for the week.</p>
            </div>
          </div>
          
          <!-- Updated planner section with two columns -->
          <div class="planner-container p-4">
            <!-- Left column: Calendar -->
            <div class="flex flex-col gap-4">
              <div class="flex items-center p-1 justify-between">
                  <button id="prev-button">
                      <div class="text-[#1C160C] flex size-10 items-center justify-center" data-icon="CaretLeft" data-size="18px" data-weight="regular">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                              <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                          </svg>
                      </div>
                  </button>
                  <p id="month-display" class="text-[#1C160C] text-base font-bold leading-tight flex-1 text-center pr-10">January 2025</p>
                  <button id="next-button">
                      <div class="text-[#1C160C] flex size-10 items-center justify-center" data-icon="CaretRight" data-size="18px" data-weight="regular">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                              <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
                          </svg>
                      </div>
                  </button>
              </div>
              <div id="calendar-container"></div>
            </div>
            
            <!-- Right column: Add meal options -->
            <div class="flex flex-col gap-4 p-4 bg-[#F4EFE6] rounded-xl">
              <h3 class="text-[#1C160C] text-lg font-bold">Add New Meal</h3>
              <p class="text-[#A18249] text-sm">Select a date and add a meal for your plan</p>
              
              <div class="flex flex-col gap-3 mt-2">
                <button 
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Breakfast</span>
                </button>
                <button 
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Lunch</span>
                </button>
                <button 
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Snack</span>
                </button>
                <button 
                  class="meal-type-btn flex items-center justify-center overflow-hidden rounded-full h-12 px-4 bg-[#019863] text-white text-sm font-bold">
                  <span>Add Dinner</span>
                </button>
              </div>
              
              <div class="mt-4">
                <p id="selected-date-display" class="text-[#1C160C] font-medium"></p>
              </div>
            </div>
          </div>
          
          <!-- Meal display section -->
          <h3 class="text-xl font-bold text-[#1C160C] p-4">Today's Meals</h3>
          <div id="meal-container" class="grid grid-cols-[repeat(auto-fill,minmax(220px,1fr))] gap-4 p-4"></div>
          
          <div class="flex flex-col gap-3 p-4">
            <div class="flex gap-6 justify-between">
              <p class="text-[#1C160C] text-base font-medium leading-normal">Meal Plan Adherence</p>
              <p class="text-[#1C160C] text-sm font-normal leading-normal">60%</p>
            </div>
            <div class="rounded bg-[#E9DFCE]">
              <div class="h-2 rounded bg-[#019863]" style="width: 60%;"></div>
            </div>
            <p class="text-[#A18249] text-sm font-normal leading-normal">Keep up the great work!</p>
          </div>
          
          <div class="flex justify-end overflow-hidden px-5 pb-5">
            <button id="add-meal-btn"
              class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-14 px-5 bg-[#019863] text-[#FFFFFF] text-base font-bold leading-normal tracking-[0.015em] min-w-0 gap-4 pl-4 pr-6">
              <div class="text-[#FFFFFF]" data-icon="UserPlus" data-size="24px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M256,136a8,8,0,0,1-8,8H232v16a8,8,0,0,1-16,0V144H200a8,8,0,0,1,0-16h16V112a8,8,0,0,1,16,0v16h16A8,8,0,0,1,256,136Zm-57.87,58.85a8,8,0,0,1-12.26,10.3C165.75,181.19,138.09,168,108,168s-57.75,13.19-77.87,37.15a8,8,0,0,1-12.25-10.3c14.94-17.78,33.52-30.41,54.17-37.17a68,68,0,1,1,71.9,0C164.6,164.44,183.18,177.07,198.13,194.85ZM108,152a52,52,0,1,0-52-52A52.06,52.06,0,0,0,108,152Z">
                  </path>
                </svg>
              </div>
              <span class="truncate">Add Meal</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
document.addEventListener("DOMContentLoaded", function () {
    // Get user information from local storage
    const userId = localStorage.getItem('userId') || '1'; // Default to 1 if not found
    
    // Load username
    fetchUsername(userId);
    
    // Calendar functionality
    const festivals = [5, 15, 25]; // Example: dates that are festivals
    const today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let selectedDate = today.toISOString().split('T')[0]; // Format: YYYY-MM-DD
    
    // Update selected date display
    document.getElementById('selected-date-display').textContent = `Selected: ${formatDateForDisplay(selectedDate)}`;

    // DOM Elements
    const calendarContainer = document.getElementById("calendar-container");
    const monthDisplay = document.getElementById("month-display");
    const prevButton = document.getElementById("prev-button");
    const nextButton = document.getElementById("next-button");
    const mealContainer = document.getElementById("meal-container");
    const addMealBtn = document.getElementById("add-meal-btn");

    // Month Names
    const monthNames = [
        "January", "February", "March", "April", "May", "June", 
        "July", "August", "September", "October", "November", "December"
    ];

    // Function to format date for display
    function formatDateForDisplay(dateString) {
        const date = new Date(dateString);
        return `${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`;
    }
    
    // Function to fetch username
    function fetchUsername(userId) {
        fetch(`http://localhost:5000/api/user/${userId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('username').textContent = data.username || 'User';
            })
            .catch(error => {
                console.error("Error fetching username:", error);
            });
    }

    // Function to Render Calendar
    const renderCalendar = (year, month) => {
        const firstDay = new Date(year, month, 1).getDay(); // First day of the month (0-indexed)
        const daysInMonth = new Date(year, month + 1, 0).getDate(); // Days in the month

        // Update Month and Year Display
        monthDisplay.textContent = `${monthNames[month]} ${year}`;

        // Days of the Week Header
        const daysOfWeek = ["S", "M", "T", "W", "T", "F", "S"];
        const gridHtml = daysOfWeek.map(day => `
            <p class="text-[#1C160C] text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">${day}</p>
        `).join("");

        // Populate Dates
        let daysHtml = "";
        for (let i = 0; i < firstDay; i++) {
            daysHtml += `<div class="h-12 w-full"></div>`; // Blank spaces for days before the first of the month
        }
        
        for (let day = 1; day <= daysInMonth; day++) {
            // Format the date as YYYY-MM-DD for the data attribute
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            // Check if this date is the selected date
            const isSelectedDate = dateStr === selectedDate;
            
            // Create dynamic classes based on date status
            let classes = "calendar-day-button h-12 w-full flex items-center justify-center";
            
            // Style for today
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                classes += " bg-[#000802] text-white rounded-full";
            } else {
                classes += " bg-[#F4EFE6] text-[#1C160C]";
            }
            
            // Style for selected date
            if (isSelectedDate) {
                classes += " selected-date";
            }
            
            // Style for festivals
            if (festivals.includes(day)) {
                classes = classes.replace("text-[#1C160C]", "text-[#FFD700]");
            }

            daysHtml += `
                <button class="${classes}" data-date="${dateStr}">
                    <div class="flex size-full items-center justify-center">${day}</div>
                </button>
            `;
        }

        // Render Calendar
        calendarContainer.innerHTML = `
            <div class="grid grid-cols-7">
                ${gridHtml}
                ${daysHtml}
            </div>
        `;
        
        // Add event listeners to the calendar day buttons
        document.querySelectorAll('.calendar-day-button').forEach(button => {
            button.addEventListener('click', function() {
                // Remove selected class from all buttons
                document.querySelectorAll('.calendar-day-button').forEach(btn => {
                    btn.classList.remove('selected-date');
                });
                
                // Add selected class to clicked button
                this.classList.add('selected-date');
                
                // Get the date from the button's data attribute
                selectedDate = this.getAttribute('data-date');
                
                // Update the selected date display
                document.getElementById('selected-date-display').textContent = `Selected: ${formatDateForDisplay(selectedDate)}`;
                
                // Fetch meals for the selected date
                fetchMeals(selectedDate);
            });
        });
    };

    // Event Listeners for Month Navigation
    prevButton.addEventListener("click", () => {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11; // Wrap to December
            currentYear--;
        }
        renderCalendar(currentYear, currentMonth);
    });

    nextButton.addEventListener("click", () => {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0; // Wrap to January
            currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
    });
    
    // Add meal button functionality
    addMealBtn.addEventListener('click', () => {
        // Here you would typically show a modal or redirect to add meal page
        alert(`Adding a new meal for ${formatDateForDisplay(selectedDate)}`);
        // You can replace this with your own functionality
    });
    
    // Add event listeners to meal type buttons
    document.querySelectorAll('.meal-type-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Continue from line 460
            const mealType = this.textContent.trim().replace('Add ', '');
            alert(`Adding ${mealType} for ${formatDateForDisplay(selectedDate)}`);
            // Implementation for adding a meal of specific type
            addMealByType(mealType, selectedDate);
        });
    });
    
    // Function to add meal by type
    function addMealByType(mealType, date) {
        // This would typically involve a form or modal to input meal details
        // For now, we'll just show an alert
        console.log(`Adding ${mealType} for ${date}`);
        
        // Here you would implement the actual meal addition, for example:
        // - Show a modal with a form
        // - Navigate to an add meal page with prefilled type and date
        // - Make an API call to add a placeholder meal
    }
    
    // Function to fetch meals for a specific date
    function fetchMeals(date) {
        const userId = localStorage.getItem('userId') || '1';
        
        // Clear existing meals
        mealContainer.innerHTML = '';
        
        // Fetch meals from API
        fetch(`http://localhost:5000/api/meals?date=${date}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(meals => {
                if (meals.length === 0) {
                    mealContainer.innerHTML = `
                        <div class="flex flex-col gap-3 pb-3 items-center text-center">
        <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-xl"
            style='background-image: url("${meal.meal_image}");'>
        </div>
        <div>
            <p class="text-[#A18249] text-sm font-normal leading-normal">${meal.meal_name}</p>
            <p class="text-[#1C160C] text-base font-medium leading-normal">${meal.meal_type}</p>
            <button
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#F4EFE6] text-[#1C160C] text-sm font-bold leading-normal tracking-[0.015em]">
                <span class="truncate">Change Meal</span>
            </button>
        </div>
    </div>
                    `;
                    return;
                }
                
                // Display meals horizontally
                displayMeals(meals);
            })
            .catch(error => {
                console.error("Error fetching meals:", error);
                mealContainer.innerHTML = `
                    <div class="col-span-full text-center py-8 text-red-500">
                        Error loading meals. Please try again later.
                    </div>
                `;
            });
    }
    
    // Function to display meals with proper image handling and horizontal layout
    function displayMeals(meals) {
        // Set up container for horizontal scrolling if needed
        mealContainer.className = "flex overflow-x-auto gap-4 p-4";
        
        meals.forEach(meal => {
            // Create a new meal card
            const mealCard = document.createElement('div');
            mealCard.className = "flex-shrink-0 w-[220px] bg-white rounded-xl shadow-md overflow-hidden cursor-pointer";
            mealCard.setAttribute('data-meal-id', meal.id);
            
            // Use a placeholder image if the URL is invalid
            const imageUrl = meal.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image';
            
            // Create HTML for the meal card
            mealCard.innerHTML = `
                <div class="relative">
                    <img 
                        src="${imageUrl}" 
                        alt="${meal.name}" 
                        class="w-full h-40 object-cover"
                        onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=Error+Loading+Image';"
                    />
                    <div class="absolute top-2 right-2 bg-[#019863] text-white text-xs font-bold px-2 py-1 rounded-full">
                        ${meal.mealType}
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="text-[#1C160C] font-bold text-lg mb-1">${meal.name}</h3>
                    <p class="text-[#A18249] text-sm mb-2">${meal.calories || '0'} calories</p>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-[#1C160C] text-xs">${meal.time || 'Any time'}</span>
                        <button class="text-[#019863] text-sm font-medium">View</button>
                    </div>
                </div>
            `;
            
            // Add click event to navigate to meal detail
            mealCard.addEventListener('click', function() {
                const mealId = this.getAttribute('data-meal-id');
                localStorage.setItem('selectedMealId', mealId);
                window.location.href = `MealDetail.html?id=${mealId}`;
            });
            
            // Add the card to the container
            mealContainer.appendChild(mealCard);
        });
        
        // If there are many meals, ensure horizontal scrolling works well
        if (meals.length > 4) {
            mealContainer.style.maxWidth = '100%';
            mealContainer.style.overflowX = 'auto';
            mealContainer.style.scrollbarWidth = 'thin';
            mealContainer.style.scrollbarColor = '#A18249 #F4EFE6';
            
            // Add scroll buttons for better UX (optional)
            const scrollLeftBtn = document.createElement('button');
            scrollLeftBtn.className = "absolute left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full shadow-md p-2";
            scrollLeftBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                </svg>
            `;
            scrollLeftBtn.addEventListener('click', () => {
                mealContainer.scrollBy({ left: -240, behavior: 'smooth' });
            });
            
            const scrollRightBtn = document.createElement('button');
            scrollRightBtn.className = "absolute right-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full shadow-md p-2";
            scrollRightBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
                </svg>
            `;
            scrollRightBtn.addEventListener('click', () => {
                mealContainer.scrollBy({ left: 240, behavior: 'smooth' });
            });
            
            // Create a container for the meal container and scroll buttons
            const scrollContainer = document.createElement('div');
            scrollContainer.className = "relative";
            
            // Replace meal container with scroll container and move meal container inside
            const parentElement = mealContainer.parentElement;
            parentElement.replaceChild(scrollContainer, mealContainer);
            scrollContainer.appendChild(mealContainer);
            scrollContainer.appendChild(scrollLeftBtn);
            scrollContainer.appendChild(scrollRightBtn);
        }
    }
    
    // Function to enhance hover animation for calendar days
    function enhanceCalendarDayHover() {
        document.querySelectorAll('.calendar-day-button').forEach(button => {
            // Add hover effect to buttons
            button.addEventListener('mouseenter', function() {
                if (!this.classList.contains('selected-date')) {
                    this.style.backgroundColor = '#EAEAEA';
                    this.style.transform = 'scale(1.05)';
                }
            });
            
            button.addEventListener('mouseleave', function() {
                if (!this.classList.contains('selected-date')) {
                    // Restore original background color
                    if (this.classList.contains('bg-[#000802]')) {
                        this.style.backgroundColor = '#000802';
                    } else {
                        this.style.backgroundColor = '#F4EFE6';
                    }
                    this.style.transform = 'scale(1)';
                }
            });
        });
    }
    
    // Initialize calendar
    renderCalendar(currentYear, currentMonth);
    enhanceCalendarDayHover();
    
    // Fetch meals for today initially
    fetchMeals(selectedDate);
    
    // Function to connect meal type buttons to "Add Meal" action
    document.querySelectorAll('.meal-type-btn').forEach(button => {
        button.addEventListener('click', function() {
            const mealType = this.textContent.trim().replace('Add ', '').toLowerCase();
            
            // This is where you'd typically redirect to a form or open a modal
            // For now, we'll just create a simple alert
            alert(`Add ${mealType} meal for ${formatDateForDisplay(selectedDate)}`);
            
            // You could also do something like:
            // window.location.href = `AddMeal.html?type=${mealType}&date=${selectedDate}`;
        });
    });
});