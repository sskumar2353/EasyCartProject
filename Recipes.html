<html>
<head>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800" />

  <title>Recipes</title>
  <link rel="icon" type="image/x-icon"
    href="https://is3-ssl.mzstatic.com/image/thumb/Purple111/v4/7d/05/17/7d0517b1-f45f-af98-bf8f-87d454ca57f6/source/512x512bb.jpg" />

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    /* Adding custom scrollbar styling */
    #recipes-container {
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #019863 #F4EFE6;
    }
    
    #recipes-container::-webkit-scrollbar {
      width: 8px;
    }
    
    #recipes-container::-webkit-scrollbar-track {
      background: #F4EFE6;
      border-radius: 10px;
    }
    
    #recipes-container::-webkit-scrollbar-thumb {
      background: #019863;
      border-radius: 10px;
    }
    
    .recipe-card {
      transition: transform 0.2s ease;
    }
    
    .recipe-card:hover {
      transform: translateY(-5px);
    }
  </style>
</head>

<body>
  <div class="relative flex size-full min-h-screen flex-col bg-[#FFFFFF] group/design-root overflow-x-hidden"
    style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#F4EFE6] px-10 py-3">
        <div class="flex items-center gap-4 text-[#1C160C]">
          <div class="size-4">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z"
                fill="currentColor"></path>
            </svg>
          </div>
          <h2 class="text-[#1C160C] text-lg font-bold leading-tight tracking-[-0.015em]">EasyCart</h2>
        </div>
        <div class="flex gap-2">
          <a href="AfterLogin.html"> <button
              class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#F4EFE6] text-[#1C160C] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
              <div class="text-[#1C160C]" data-icon="House" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="none" viewBox="0 0 256 256"
                  stroke="currentColor" stroke-width="16">
                  <path
                    d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z">
                  </path>
                </svg>
              </div>
            </button> </a>
          <button
            class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#F4EFE6] text-[#1C160C] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
            <a href="Profile.html">
              <div class="text-[#1C160C]" data-icon="User" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                  </path>
                </svg>
              </div>
            </a>
          </button>
        </div>
      </header>
      <div class="gap-1 px-6 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-80">
          <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#FFFFFF] p-4">
            <div class="flex flex-col gap-4">
              <div class="flex flex-col">
                <h1 class="text-[#1C160C] text-base font-medium leading-normal">Search &amp; Filter</h1>
                <p class="text-[#A18249] text-sm font-normal leading-normal">Find recipes easily</p>
              </div>
              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-3 px-3 py-2 rounded-full bg-[#F4EFE6]">
                  <div class="text-[#1C160C]" data-icon="MagnifyingGlass" data-size="24px" data-weight="fill">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M168,112a56,56,0,1,1-56-56A56,56,0,0,1,168,112Zm61.66,117.66a8,8,0,0,1-11.32,0l-50.06-50.07a88,88,0,1,1,11.32-11.31l50.06,50.06A8,8,0,0,1,229.66,229.66ZM112,184a72,72,0,1,0-72-72A72.08,72.08,0,0,0,112,184Z">
                      </path>
                    </svg>
                  </div>
                  <p class="text-[#1C160C] text-sm font-medium leading-normal">Search</p>
                </div>
                <!-- <div class="flex items-center gap-3 px-3 py-2">
                  <div class="text-[#1C160C]" data-icon="List" data-size="24px" data-weight="regular">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z">
                      </path>
                    </svg>
                  </div>
                  <a href="FindRecipies.html">
                    <p class="text-[#1C160C] text-sm font-medium leading-normal">Ingredients</p>
                  </a>
                </div> -->
              </div>
            </div>
            <div id="dietary-preferences-container" class="flex gap-3 p-3 flex-wrap pr-4 overflow-y-auto max-h-64"></div>
            <!-- <button id="show-more" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#019863] text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]">Show More</button> -->
            <button id="apply-filters" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#019863] text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]">Apply Filters</button>
            <button id="clear-filters" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#019863] text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]">
              <span class="truncate">Clear Filters</span>
            </button>
          </div>
        </div>
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
          <div class="px-4 py-3">
            <label class="flex flex-col min-w-40 h-12 w-full">
              <div class="flex w-full flex-1 items-stretch rounded-xl h-full">
                <div
                  class="text-[#A18249] flex border-none bg-[#F4EFE6] items-center justify-center pl-4 rounded-l-xl border-r-0"
                  data-icon="MagnifyingGlass" data-size="24px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                      d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z">
                    </path>
                  </svg>
                </div>
                <input type="text" id="search-input" placeholder="Search for recipes" 
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1C160C] focus:outline-0 focus:ring-0 border-none bg-[#F4EFE6] focus:border-none h-full placeholder:text-[#A18249] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal"
                  value="" />
                <button id="search-button"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-r-xl h-full px-4 bg-[#019863] text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]">  
                  <span class="truncate">Search</span>
                </button>
              </div>
            </label>
          </div>
          <div id="selected-preferences" class="flex gap-3 p-3 flex-wrap pr-4"></div>
          <div id="recipe-results" class="mt-4"></div>
          <div class="grid grid-cols-[repeat(auto-fit,minmax(158px,1fr))] gap-3 p-4">
            <div id="recipes-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4 w-full"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dietaryContainer = document.getElementById("dietary-preferences-container");
      // const showMoreButton = document.getElementById("show-more");
      const applyFiltersButton = document.getElementById("apply-filters");
      const clearFiltersButton = document.getElementById("clear-filters");
      const selectedPreferencesContainer = document.getElementById("selected-preferences");
      const searchButton = document.getElementById("search-button");
      const searchInput = document.getElementById("search-input");
      
      dietaryContainer.innerHTML = "";
      selectedPreferencesContainer.innerHTML = "";

      const selectedPreferences = [];

      const allPreferences = [
      "Vegetarian","Halal","Mediterranean","High-Protein","Pescatarian","Vegan","Carnivore","High-Fat"
      ];

      const topPreferences = allPreferences.slice(0, 10);
      const remainingPreferences = allPreferences.slice(10);

      function createPreferenceButton(preference, hidden = false) {
        const div = document.createElement("div");
        div.className = "flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F4EFE6] pl-4 pr-4 mb-2";
        if (hidden) div.style.display = "none";
        div.setAttribute("data-preference", preference);

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = preference;
        checkbox.className = "hidden preference-checkbox";
        checkbox.checked = selectedPreferences.includes(preference);
        
        const label = document.createElement("label");
        label.className = "cursor-pointer flex items-center gap-x-2";
        label.innerHTML = `
        <div class="w-5 h-5 border-2 border-gray-700 rounded-full flex justify-center items-center">
          ${checkbox.checked ? '<div class="w-3 h-3 bg-gray-700 rounded-full"></div>' : ""}
        </div>
        <span class="text-[#1C160C] text-sm font-medium leading-normal">${preference}</span>
      `;
        
        label.addEventListener("click", () => {
          checkbox.checked = !checkbox.checked;
          
          if (checkbox.checked) {
            if (!selectedPreferences.includes(preference)) {
              selectedPreferences.push(preference);
            }
          } else {
            const index = selectedPreferences.indexOf(preference);
            if (index !== -1) {
              selectedPreferences.splice(index, 1);
            }
          }
          
          label.innerHTML = `
          <div class="w-5 h-5 border-2 border-gray-700 rounded-full flex justify-center items-center">
            ${checkbox.checked ? '<div class="w-3 h-3 bg-gray-700 rounded-full"></div>' : ""}
          </div>
          <span class="text-[#1C160C] text-sm font-medium leading-normal">${preference}</span>
        `;
        });

        div.appendChild(checkbox);
        div.appendChild(label);
        dietaryContainer.appendChild(div);
        return div;
      }

      topPreferences.forEach(preference => createPreferenceButton(preference));
      const hiddenElements = remainingPreferences.map(pref => createPreferenceButton(pref, true));

      // showMoreButton.addEventListener("click", () => {
      //   hiddenElements.forEach(el => el.style.display = "flex");
      //   showMoreButton.style.display = "none";
      // });

      // Load initial 10 recipes when the page loads
      loadInitialRecipes();

      function loadInitialRecipes() {
        fetch('http://localhost:5000/api/recipes')
          .then(response => response.json())
          .then(data => {
            console.log(data);
            displayRecipes(data);
          })
          .catch(error => {
            console.error("Error fetching initial recipes:", error);
            document.getElementById("recipes-container").innerHTML = "<p class='text-center text-red-500'>Error loading recipes.</p>";
          });
      }

      function displayRecipes(recipes) {
        const container = document.getElementById("recipes-container");
        container.innerHTML = ""; // Clear previous content

        if (recipes.length === 0) {
          container.innerHTML = "<p class='text-center col-span-full text-gray-500'>No recipes found that match your criteria.</p>";
          return;
        }

        recipes.forEach(recipe => {
          const recipeCard = document.createElement("div");
          recipeCard.classList.add("recipe-card", "flex", "flex-col", "rounded-xl", "shadow-md", "hover:shadow-lg", "transition-all", "duration-300", "bg-white", "p-2");

          recipeCard.innerHTML = `
            <div class="clickableImage w-full bg-center bg-no-repeat aspect-square bg-cover rounded-xl cursor-pointer"
              style='background-image: url("https://static.vecteezy.com/system/resources/previews/002/233/113/non_2x/restaurant-service-abstract-logo-template-symbol-icon-free-vector.jpg");'
              data-id="${recipe.recipe_id}">
            </div>
            <p class="text-[#1C160C] text-base font-medium mt-2 leading-normal">${recipe.recipe_name}</p>
            ${recipe.dietary_preferences ? `<p class="text-[#A18249] text-xs">${recipe.dietary_preferences}</p>` : ''}
          `;

          container.appendChild(recipeCard);
        });

        // Add event listeners to the newly created elements
        document.querySelectorAll(".clickableImage").forEach(image => {
          image.addEventListener("click", (event) => {
            const recipeId = event.currentTarget.getAttribute("data-id");
            window.location.href = `IngredientsList.html?recipe_id=${encodeURIComponent(recipeId)}`;
          });
        });
      }

      // Apply Filters button functionality
      applyFiltersButton.addEventListener("click", () => {
        selectedPreferencesContainer.innerHTML = "";
        
        if (selectedPreferences.length === 0) {
          selectedPreferencesContainer.innerHTML = "<p class='text-gray-500'>No preferences selected</p>";
          loadInitialRecipes(); // Reset to initial recipes
          return;
        }
        
        // Display selected preferences
        selectedPreferences.forEach(preference => {
          const button = document.createElement("div");
          button.className = "flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F4EFE6] pl-4 pr-2";
          button.innerHTML = `
            <p class="text-[#1C160C] text-sm font-medium leading-normal">${preference}</p>
            <div class="text-[#1C160C] cursor-pointer remove-preference" data-preference="${preference}">
              <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
              </svg>
            </div>
          `;
          selectedPreferencesContainer.appendChild(button);
        });
        
        // Add event listeners to remove preference buttons
        document.querySelectorAll(".remove-preference").forEach(btn => {
          btn.addEventListener("click", (e) => {
            const preference = e.currentTarget.getAttribute("data-preference");
            const index = selectedPreferences.indexOf(preference);
            if (index !== -1) {
              selectedPreferences.splice(index, 1);
            }
            
            // Uncheck the corresponding checkbox
            const checkbox = document.querySelector(`[data-preference="${preference}"] input`);
            if (checkbox) {
              checkbox.checked = false;
              const label = checkbox.nextElementSibling;
              label.innerHTML = `
                <div class="w-5 h-5 border-2 border-gray-700 rounded-full flex justify-center items-center"></div>
                <span class="text-[#1C160C] text-sm font-medium leading-normal">${preference}</span>
              `;
            }
            
            // Remove the preference tag
            e.currentTarget.parentElement.remove();
            
            // If no preferences left, reset to initial recipes
            if (selectedPreferences.length === 0) {
              selectedPreferencesContainer.innerHTML = "<p class='text-gray-500'>No preferences selected</p>";
              loadInitialRecipes();
            } else {
              // Otherwise, filter again with remaining preferences
              filterRecipesByPreferences();
            }
          });
        });
        
        // Fetch recipes filtered by preferences
        filterRecipesByPreferences();
      });

      function filterRecipesByPreferences() {
        if (selectedPreferences.length === 0) {
          loadInitialRecipes();
          return;
        }
        
        fetch('http://localhost:5000/api/recipes/filter', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ preferences: selectedPreferences }),
        })
          .then(response => response.json())
          .then(data => {
            displayRecipes(data);
          })
          .catch(error => {
            console.error("Error filtering recipes:", error);
            document.getElementById("recipes-container").innerHTML = "<p class='text-center text-red-500'>Error filtering recipes.</p>";
          });
      }

      // Clear filters button functionality
      clearFiltersButton.addEventListener("click", () => {
        // Clear selected preferences
        selectedPreferences.length = 0;
        selectedPreferencesContainer.innerHTML = "<p class='text-gray-500'>No preferences selected</p>";
        
        // Uncheck all checkboxes
        document.querySelectorAll(".preference-checkbox").forEach(checkbox => {
          checkbox.checked = false;
          const label = checkbox.nextElementSibling;
          const preference = checkbox.value;
          label.innerHTML = `
            <div class="w-5 h-5 border-2 border-gray-700 rounded-full flex justify-center items-center"></div>
            <span class="text-[#1C160C] text-sm font-medium leading-normal">${preference}</span>
          `;
        });
        
        // Reset to initial recipes
        loadInitialRecipes();
        
        // Clear search input
        searchInput.value = "";
      });

      // Search functionality
      searchButton.addEventListener("click", searchRecipes);
      searchInput.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
          event.preventDefault();
          searchRecipes();
        }
      });

      function searchRecipes() {
        const recipeName = searchInput.value.trim();
        if (!recipeName) {
          alert("Please enter a recipe name to search.");
          return;
        }

        fetch(`http://localhost:5000/api/recipe_search/${encodeURIComponent(recipeName)}`)
          .then(response => response.json())
          .then(data => {
            // Hide the regular recipes container when showing search results
            document.getElementById("recipes-container").style.display = "none";
            
            const resultsContainer = document.getElementById("recipe-results");
            resultsContainer.innerHTML = "";
            resultsContainer.className = "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4";

            if (!Array.isArray(data) || data.length === 0) {
              resultsContainer.innerHTML = `
                <p class="text-center col-span-full text-gray-500 p-4">No recipes found matching "${recipeName}". Try another search.</p>
              `;
              return;
            }

            // Create a heading for search results
            const heading = document.createElement("h2");
            heading.className = "text-xl font-bold col-span-full mb-4";
            heading.textContent = `Search results for "${recipeName}"`;
            resultsContainer.appendChild(heading);

            data.forEach(recipe => {
              const recipeCard = document.createElement("div");
              recipeCard.classList.add("recipe-card", "flex", "flex-col", "rounded-xl", "shadow-md", "hover:shadow-lg", "transition-all", "duration-300", "bg-white", "p-2");

              recipeCard.innerHTML = `
                <div class="clickableSearchImage w-full bg-center bg-no-repeat aspect-square bg-cover rounded-xl cursor-pointer"
                  style='background-image: url("https://static.vecteezy.com/system/resources/previews/002/233/113/non_2x/restaurant-service-abstract-logo-template-symbol-icon-free-vector.jpg");'
                  data-id="${recipe.recipe_id}">
                </div>
                <p class="text-[#1C160C] text-base font-medium mt-2 leading-normal">${recipe.recipe_name}</p>
                ${recipe.dietary_preferences ? `<p class="text-[#A18249] text-xs">${recipe.dietary_preferences}</p>` : ''}
              `;

              resultsContainer.appendChild(recipeCard);
            });

            // Add event listeners to the newly created search result elements
            document.querySelectorAll(".clickableSearchImage").forEach(image => {
              image.addEventListener("click", (event) => {
                const recipeId = event.currentTarget.getAttribute("data-id");
                window.location.href = `IngredientsList.html?recipe_id=${encodeURIComponent(recipeId)}`;
              });
            });

            // Add a "return to all recipes" button
            const returnButton = document.createElement("button");
            returnButton.className = "col-span-full mx-auto mt-4 flex cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#A18249] text-[#FFFFFF] text-sm font-bold leading-normal tracking-[0.015em]";
            returnButton.innerHTML = `
              <span class="truncate">Return to All Recipes</span>
            `;
            returnButton.addEventListener("click", () => {
              resultsContainer.innerHTML = "";
              document.getElementById("recipes-container").style.display = "grid";
              searchInput.value = "";
            });
            resultsContainer.appendChild(returnButton);
          })
          .catch(error => {
            console.error("Error searching recipes:", error);
            const resultsContainer = document.getElementById("recipe-results");
            resultsContainer.innerHTML = `
              <p class="text-center text-red-500 p-4">Error searching for recipes. Please try again later.</p>
            `;
          });
      }
    });
  </script>
</body>
</html>